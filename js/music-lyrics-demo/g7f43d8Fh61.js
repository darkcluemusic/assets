/* Compile by Suryo DwiJayanto */
firebase.initializeApp(firebaseConfig);function PreviewAudio(inputFile,previewElement){if(inputFile.files&&inputFile.files[0]&&$(previewElement).length>0){$(previewElement).stop();var reader=new FileReader();reader.onload=function(e){$(previewElement).attr('src',e.target.result);var files=e.target.files;var fileName=inputFile.files[0].name;var playResult=$(previewElement).get(0).pause();if(playResult!==undefined){playResult.then(_=>{$(previewElement).show()}).catch(error=>{$(previewElement).hide();alert("File Is Not Valid Media File")})}};reader.readAsDataURL(inputFile.files[0])}else{$(previewElement).attr('src','');$(previewElement).hide();alert("File Not Selected")}}window.onload=function(){const fileCollection=document.getElementsByClassName('audioPreview');for(let fileInput of fileCollection){fileInput.addEventListener('change',getFileName)}}const getFileName=(event)=>{const files=event.target.files;const fileName=files[0].name}const inputImg=document.getElementById('imginput');var dataImages;const previewPhoto=()=>{const file=inputImg.files;if(file){const fileReader=new FileReader();const preview=document.getElementById('mcover');fileReader.onload=function(event){preview.setAttribute('style','background-image: url('+event.target.result+') !important');dataImages=event.target.result}fileReader.readAsDataURL(file[0])}}inputImg.addEventListener("change",previewPhoto);var str1,str2,mreslt;var myoutputlink=document.getElementById("output").value;function mOutput(){str1=document.getElementById("artis").value;str2=document.getElementById("lagu").value;mreslt=str1.replace(/ /g,"-").toLowerCase()+"-"+str2.replace(/ /g,"-").toLowerCase();myoutputlink=mreslt}var _data='';var currentLine='';function mDone(){var mart=document.getElementById("artis").value,mlagu=document.getElementById("lagu").value;if(!mart||!mlagu||!document.getElementById("imginput").value||!document.getElementById("stext").value||!document.getElementById("mamxa").value){alert("Pastikan semua sudah terisi!")}else{document.getElementById("mupload").disabled=!0;document.getElementById("mupload").style.cursor="no-drop";document.getElementById("mupload").removeAttribute('onclick');if(confirm('Apakah kamu ingin memasukkan data ini ke dalam database?')){var filess=document.getElementById("mamxa").files[0];var types="post/"+myoutputlink;var storages=firebase.storage();var storagerefs=storages.ref();var thisrefs=storagerefs.child(types).child(filess.name).put(filess);thisrefs.on("state_changed",function(snapshot){},function(error){},function(){thisrefs.snapshot.ref.getDownloadURL().then(function(downloadURL){document.getElementById("urlmusik").value=downloadURL;alert("Berhasil! lihat hasilnya di https://darkcluemusic.github.io/dcmplayer/");saveMusic(downloadURL);window.open("https://darkcluemusic.github.io/dcmplayer/")})})}else{fOoh()}}}function saveMusic(downloadURL){var mart=document.getElementById("artis").value,mlagu=document.getElementById("lagu").value;var lc=JSON.parse(document.getElementById("stext").value);firebase.database().ref("post/"+myoutputlink+"/").set({artist:mart,song:mlagu,image:dataImages,music:downloadURL,uniq:myoutputlink,lc,});fOoh()}function fOoh(){_data=JSON.parse(document.getElementById("stext").value);document.getElementById("martis").innerHTML=document.getElementById("artis").value;document.getElementById("mlagu").innerHTML=document.getElementById("lagu").value;document.getElementById("main-inp").style.display="none";document.getElementById("main-music").style.display="flex";mounted()}function align(){var a=$('.highlighted').height();var c=$('.content').height();var d=$('.highlighted').offset().top-$('.highlighted').parent().offset().top;var e=d+a/2-c/2;$('.content').animate({scrollTop:e+'px'},{easing:'swing',duration:250})}var lyricHeight=$('.lyrics').height();$(window).on('resize',function(){if($('.lyrics').height()!=lyricHeight){lyricHeight=$('.lyrics').height();align()}});$(document).ready(function(){$('audio').on('timeupdate',function(e){var time=this.currentTime*1000;var past=_data.lyrics.filter(function(item){return item.time<time});if(_data.lyrics[past.length]!=currentLine){currentLine=_data.lyrics[past.length];$('.lyrics div').removeClass('highlighted');$(`.lyrics div:nth-child(${past.length})`).addClass('highlighted');align()}})});function generate(){var html='';for(var i=0;i<_data.lyrics.length;i++){html+='<div';if(i==0){html+=` class="highlighted"`;currentLine=0}if(_data.lyrics[i].note){html+=` note="${_data['lyrics'][i]['note']}"`}html+='>';html+=_data.lyrics[i].line==''?'â€¢':_data.lyrics[i].line;html+='</div>'}$('.lyrics').html(html);align()}async function mounted(){await generate()}
